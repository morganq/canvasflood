<html>
<head>
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="https://rawgithub.com/nodeca/pako/master/dist/pako.js"></script>
	<script>
		$(document).ready(function() {
			var cvs = document.getElementById("canvas");
			var ctx = cvs.getContext("2d");

			sock = new WebSocket("ws://54.153.106.51:8080/delta");
			sock.binaryType='arraybuffer';

			sock.onmessage = function(event) {
				var t_start = performance.now();

				var outdata = pako.inflate(event.data);
				var t_inflate = performance.now();
				
				var px = new Uint8ClampedArray(outdata);
				var img = ctx.createImageData(800,600);
				img.data.set(px, 0);
				var t_imagedata = performance.now();

				var tempcvs = document.createElement("canvas");
				tempcvs.width=800; tempcvs.height=600;
				tempctx = tempcvs.getContext("2d");
				tempctx.putImageData(img, 0,0);
				ctx.drawImage(tempcvs, 0, 0);
				var t_blit = performance.now();
				
				console.log("Bytes received: " + event.data.byteLength);
				console.log("Time to inflate: " + (t_inflate - t_start));
				console.log("Time to build image: " + (t_imagedata - t_inflate));
				console.log("Time to blit: " + (t_blit - t_imagedata));
			}

		})
	</script>

</head>
<body>
	<canvas id="canvas" width="800" height="600"></canvas>
</body>
</html>
